import{e,d as t,j as a,s as r,ak as l,aj as o,E as n,b as s,w as i,al as d,r as u,o as c,A as m}from"./index-1b14cce8.js";import{g as p,d as f}from"./index-365e1209.js";const g={default:({row:t,column:a})=>{const r=t[a.field];return[e("span",{class:`el-tag el-tag--${"admin"===r?"":"warning"} el-tag--plain`},[r])]}},v={default:({row:t,column:a})=>{let r="danger",l="禁用";return t[a.field]&&(r="success",l="启用"),[e("span",{class:`el-tag el-tag--${r} el-tag--plain`},[l])]}},h={class:"app-container"},y=t({name:"VxeTable"}),b=t({...y,setup(t){const y=a(),b=a(),w=a(),x=r({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>{var e;return null==(e=b.value)||e.clearValidate(),Promise.resolve()}}),k=r({loading:!0,autoResize:!0,pagerConfig:{align:"right"},formConfig:{items:[{field:"username",itemRender:{name:"$input",props:{placeholder:"用户名",clearable:!0}}},{field:"phone",itemRender:{name:"$input",props:{placeholder:"手机号",clearable:!0}}},{itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}]},toolbarConfig:{refresh:!0,custom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},columns:[{type:"checkbox",width:"50px"},{field:"username",title:"用户名"},{field:"roles",title:"角色",slots:g},{field:"phone",title:"手机号"},{field:"email",title:"邮箱"},{field:"status",title:"状态",slots:v},{field:"createTime",title:"创建时间"},{title:"操作",width:"150px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,props:{total:"total"},ajax:{query:({page:e,form:t})=>(k.loading=!0,P.clearTable(),new Promise((a=>{let r=0,l=[];const o=e=>{if(e&&e.data){const t=e.data;Number.isInteger(t.total)&&(r=t.total),Array.isArray(t.list)&&(l=t.list)}k.loading=!1,a({total:r,result:l})},n={username:t.username||void 0,phone:t.phone||void 0,size:e.pageSize,currentPage:e.currentPage};p(n).then(o).catch(o)})))}}}),C=r({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{username:"",password:""},items:[{field:"username",title:"用户名",itemRender:{name:"$input",props:{placeholder:"请输入"}}},{field:"password",title:"密码",itemRender:{name:"$input",props:{placeholder:"请输入"}}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>{var e;return null==(e=w.value)?void 0:e.close()}}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>P.onSubmitForm()}}]}}],rules:{username:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入")}],password:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入")}]}}),P=r({isUpdate:!0,commitQuery:()=>{var e;return null==(e=y.value)?void 0:e.commitProxy("query")},clearTable:()=>{var e;return null==(e=y.value)?void 0:e.reloadData([])},onShowModal:e=>{var t,a,r;e?(P.isUpdate=!0,x.title="修改用户",C.data.username=e.username):(P.isUpdate=!1,x.title="新增用户"),C.items&&(null==(a=null==(t=C.items[0])?void 0:t.itemRender)?void 0:a.props)&&(C.items[0].itemRender.props.disabled=P.isUpdate),null==(r=w.value)||r.open(),l((()=>{var e,t;!P.isUpdate&&(null==(e=b.value)||e.reset()),null==(t=b.value)||t.clearValidate()}))},onSubmitForm:()=>{var e;C.loading||null==(e=b.value)||e.validate((e=>{if(e)return;C.loading=!0;const t=e=>{var t;C.loading=!1,e||(null==(t=w.value)||t.close(),n.success("操作成功"),!P.isUpdate&&P.afterInsert(),P.commitQuery())};P.isUpdate,setTimeout((()=>t()),1e3)}))},afterInsert:()=>{var e,t;const a=null==(t=null==(e=y.value)?void 0:e.getProxyInfo())?void 0:t.pager;if(a){a.currentPage*a.pageSize===a.total&&++a.currentPage}},onDelete:e=>{const t=`确定 <strong style='color:red;'>删除</strong> 用户 <strong style='color:#409eff;'>${e.username}</strong> ？`;o.confirm(t,"提示",{type:"warning",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{f(e.id).then((()=>{n.success("删除成功"),P.afterDelete(),P.commitQuery()})).catch((()=>1))})).catch((()=>1))},afterDelete:()=>{var e,t;const a=y.value.getData(),r=null==(t=null==(e=y.value)?void 0:e.getProxyInfo())?void 0:t.pager;r&&r.currentPage>1&&1===a.length&&--r.currentPage},moreFunc:()=>{}});return(t,a)=>{const r=u("vxe-button"),l=u("el-button"),o=u("vxe-grid"),n=u("vxe-form"),p=u("vxe-modal");return c(),s("div",h,[e(o,d({ref_key:"xGridDom",ref:y},k),{"toolbar-btns":i((()=>[e(r,{status:"primary",icon:"vxe-icon-add",onClick:a[0]||(a[0]=e=>P.onShowModal())},{default:i((()=>[m(" 新增用户 ")])),_:1}),e(r,{status:"danger",icon:"vxe-icon-delete"},{default:i((()=>[m(" 批量删除 ")])),_:1})])),"row-operate":i((({row:t})=>[e(l,{link:"",type:"primary",onClick:e=>P.onShowModal(t)},{default:i((()=>[m(" 修改 ")])),_:2},1032,["onClick"]),e(l,{link:"",type:"danger",onClick:e=>P.onDelete(t)},{default:i((()=>[m(" 删除 ")])),_:2},1032,["onClick"])])),_:1},16),e(p,d({ref_key:"xModalDom",ref:w},x),{default:i((()=>[e(n,d({ref_key:"xFormDom",ref:b},C),null,16)])),_:1},16)])}}});export{b as default};
